Intent — это объект, который позволяет компонентам приложения запрашивать функциональность от других компонентов. В основном интенты используются для:

1. Запуска активности (Activity)

2. Запуска службы (Service)

3. Запуска широковещательной передачи (Broadcast)

Виды интентов:

1. Явный (explicit) интент — указывает, какой именно компонент нужно запустить, зная его точное имя класса (ClassName) или какое приложение следует открыть.

2. Неявный (implicit) интент — не указывает конкретный компонент, а определяет действие, которое нужно выполнить, чтобы компонент из другого приложения мог его обработать. Например, показать местоположение.

Как интент обрабатывается: Сначала он поступает в систему, а затем система самостоятельно доставляет его до соответствующего компонента.

Когда используется неявный интент, система Android определяет подходящий компонент для запуска, сравнивая содержимое интента с фильтрами интентов (intent filters), объявленными в манифесте других приложений на устройстве.

Фильтр интентов (intent filter) — это выражение в файле манифеста приложения, которое указывает, какие типы интентов компонент готов принимать.

Внимание: Чтобы обеспечить безопасность приложения, всегда используйте явный интент при запуске службы (Service) и не объявляйте фильтры интентов для служб. Использование неявного интента для запуска службы представляет угрозу безопасности, поскольку невозможно точно определить, какая служба ответит на интент, а пользователь не увидит, какая служба запускается. Начиная с Android 5.0 (API 21), система вызывает исключение, если вы используете bindService() с неявным интентом.

Что содержится в интенте:

Имя компонента (Component name) — указывает конкретный компонент, который должен быть запущен.

Действие (Action) — строка, определяющая общее действие для выполнения (например, "просмотр" или "выбор"). Вы можете задавать собственные действия для использования внутри приложения или для вызова компонентов вашего приложения другими приложениями, но обычно используются константы действий, определённые в классе Intent или других классах фреймворка: ACTION_VIEW, ACTION_SEND, SETTINGS.SOMETHING.

Данные (Data) — объект URI, указывающий на данные, с которыми нужно работать, и/или тип MIME этих данных. Тип данных обычно зависит от действия интента. Однако тип MIME иногда может быть выведен из URI, особенно если данные представлены в виде content: URI. Такой URI указывает, что данные находятся на устройстве и управляются ContentProvider, что делает тип MIME видимым для системы. Метод: setDataAndType().

Категория (Category) — строка, содержащая дополнительную информацию о типе компонента, который должен обработать интент. В интент можно добавить любое количество категорий, но в большинстве случаев категории не требуются. Примеры распространённых категорий: CATEGORY_BROWSABLE — целевая активность может быть запущена веб-браузером для отображения данных по ссылке, например изображения или email-сообщения. CATEGORY_LAUNCHER — активность является начальной в задаче и отображается в лаунчере системы. Метод: addCategory().

Дополнительно (Extras) — пары ключ-значение, содержащие дополнительную информацию, необходимую для выполнения запрошенного действия. Некоторые действия используют определённые типы URI данных, а некоторые — определённые дополнительные данные. Например, при создании интента для отправки email с действием ACTION_SEND можно указать получателя с ключом EXTRA_EMAIL и тему с ключом EXTRA_SUBJECT. Класс Intent определяет множество констант EXTRA_* для стандартных типов данных.

Внимание: Не используйте данные типа Parcelable или Serializable при отправке интента, который должен получить другое приложение. Если приложение попытается получить доступ к данным в объекте Bundle, но не имеет доступа к сериализованному или парселируемому классу, система вызовет RuntimeException.

Флаги (Flags) — флаги, определённые в классе Intent, которые служат метаданными для интента. Флаги могут указывать системе Android, как запускать активность (например, к какому заданию она должна относиться) и как обрабатывать её после запуска (например, включать ли её в список последних активностей).

Получение неявного интента

Чтобы указать, какие неявные интенты ваше приложение может принимать, объявите один или несколько фильтров интентов для каждого компонента приложения с помощью элемента <intent-filter> в файле манифеста. Каждый фильтр интентов определяет типы принимаемых интентов на основе действия, данных и категории. Система доставляет неявный интент компоненту вашего приложения только в том случае, если он проходит через один из ваших фильтров.

<action> — объявляет принимаемое действие интента в атрибуте name. Значение должно быть буквальной строкой действия, а не константой класса.
<data> — объявляет принимаемый тип данных с использованием атрибутов, которые определяют различные аспекты URI данных (scheme, host, port, path) и тип MIME.
<category> — объявляет принимаемую категорию интента в атрибуте name. Значение должно быть буквальной строкой категории, а не константой класса.

Примечание: Чтобы принимать неявные интенты, в фильтре интентов необходимо включить категорию CATEGORY_DEFAULT. Методы startActivity() и startActivityForResult() рассматривают все интенты так, как будто они содержат категорию CATEGORY_DEFAULT. Если вы не укажете эту категорию в фильтре, ни один неявный интент не будет направлен на вашу активность.

Внимание: Использование фильтра интентов не является надёжным способом предотвратить запуск ваших компонентов другими приложениями. Хотя фильтры ограничивают компонент реагировать только на определённые типы неявных интентов, другое приложение может потенциально запустить ваш компонент с помощью явного интента, если разработчик узнает имена ваших компонентов. Если важно, чтобы только ваше приложение могло запускать один из ваших компонентов, не объявляйте фильтры интентов в манифесте. Вместо этого установите атрибут exported в значение "false" для этого компонента.

Аналогично, чтобы случайно не запустить службу другого приложения, всегда используйте явный интент для запуска собственной службы.

Использование отложенного интента (PendingIntent)

Объект PendingIntent — это обёртка вокруг объекта Intent. Основная цель PendingIntent — предоставить стороннему приложению разрешение использовать содержащийся в нём интент так, как если бы он выполнялся из процесса вашего приложения.

Основные случаи использования отложенного интента:

Объявление интента, который будет выполнен, когда пользователь взаимодействует с уведомлением вашего приложения (выполняется менеджером уведомлений Android).
Объявление интента, который будет выполнен при взаимодействии с виджетом приложения (выполняется приложением домашнего экрана).
Объявление интента, который будет выполнен в заданное время в будущем (выполняется менеджером будильников Android).

При использовании PendingIntent ваше приложение не выполняет интент напрямую с помощью вызова, например, startActivity(). Вместо этого вы указываете предполагаемый тип компонента при создании PendingIntent, вызывая соответствующий метод:

PendingIntent.getActivity() — для интента, запускающего активность.
PendingIntent.getService() — для интента, запускающего службу.
PendingIntent.getBroadcast() — для интента, запускающего широковещательный приёмник.

PendingIntent — это механизм в Android, который позволяет внешнему приложению или компоненту (например, системному уведомлению или будильнику) выполнять операцию от имени вашего приложения. Он предоставляет способ сохранить "намерение" для выполнения действия и использовать его позже, даже если ваше приложение уже не работает.

Зачем это нужно? Рассмотрим примеры:

1. Уведомления: При нажатии на уведомление ваше приложение может открыть активность или отправить сообщение, даже если оно не активно. PendingIntent сообщает системе, какое действие выполнить.

2. Будильники: Если ваше приложение использует AlarmManager для установки будильника, PendingIntent указывает, что нужно сделать (например, запустить службу), когда будильник сработает.

3. Виджеты: При нажатии на виджет на рабочем столе PendingIntent позволяет открыть активность.

Разрешение интента (Intent resolution)

Когда система получает неявный интент для запуска активности, она ищет подходящую активность, сравнивая интент с фильтрами интентов по трём аспектам:

Действие (Action).
Данные (Data: URI и тип данных).
Категория (Category).

Соответствие интентов (Intent Matching)

Интенты сопоставляются с фильтрами не только для определения целевого компонента, но и для получения информации о наборе компонентов на устройстве. Например, приложение "Домашний экран" заполняет список приложений, находя все активности с фильтрами интентов, указывающими действие ACTION_MAIN и категорию CATEGORY_LAUNCHER. Соответствие считается успешным, только если действия и категории в интенте совпадают с фильтром, как описано в документации класса IntentFilter.

Ваше приложение может использовать сопоставление интентов аналогично тому, как это делает приложение "Домашний экран". Класс PackageManager предоставляет методы query...(), которые возвращают все компоненты, способные принять конкретный интент, и методы resolve...(), определяющие лучший компонент для ответа на интент. Например:

queryIntentActivities() — возвращает список всех активностей, которые могут выполнить переданный интент.
queryIntentServices() — возвращает список служб.
queryBroadcastReceivers() — возвращает список широковещательных приёмников.

Эти методы не активируют компоненты, а лишь перечисляют те, которые могут ответить.
